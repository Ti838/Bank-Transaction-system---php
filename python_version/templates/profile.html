{% extends "base.html" %}

{% block title %}Profile - Trust Mora Bank{% endblock %}

{% block body %}
<section class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold font-poppins gradient-text mb-2">My Profile</h1>
            <p class="text-gray-400">Manage your account information and settings</p>
        </div>

        <form method="POST" action="/profile" enctype="multipart/form-data" class="space-y-8">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

            <!-- Profile Picture Section -->
            <div class="glass-light p-8 rounded-xl border border-primary-500/30">
                <h2 class="text-2xl font-bold font-poppins text-white mb-2">{{ user.full_name }}</h2>
                <div class="flex items-center space-x-2 text-primary-400 mb-6">
                    <span
                        class="px-3 py-1 rounded-full text-xs font-medium bg-primary-500/10 border border-primary-500/20">
                        {{ user.role.name }}
                    </span>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="flex-shrink-0">
                        {% if user.profile_picture %}
                        <img src="{{ url_for('static', filename='uploads/profiles/' + user.profile_picture) }}"
                            alt="Profile" class="w-32 h-32 rounded-full object-cover border-4 border-primary-500/30">
                        {% else %}
                        <img src="{{ url_for('static', filename='uploads/profiles/default_avatar.png') }}"
                            alt="Default Avatar"
                            class="w-32 h-32 rounded-full object-cover border-4 border-primary-500/30">
                        {% endif %}
                    </div>
                    <div class="flex-1">
                        <label for="profile_picture" class="block text-sm font-medium text-gray-300 mb-2">
                            <i class="fas fa-camera mr-2 text-primary-400"></i>Change Profile Picture
                        </label>
                        <input type="file" id="profile_picture" name="profile_picture" accept="image/*" class="w-full px-4 py-3 bg-slate-900/50 border border-primary-500/30 rounded-lg text-white
                                   file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0
                                   file:bg-primary-500/20 file:text-primary-400 file:cursor-pointer
                                   hover:file:bg-primary-500/30 transition-all">
                        <p class="mt-2 text-xs text-gray-400">Supported: PNG, JPG, JPEG, GIF (Max 5MB)</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Personal Information -->
                <div class="glass-light p-8 rounded-xl border border-primary-500/30">
                    <h2 class="text-2xl font-bold text-white mb-6">Personal Information</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="username" class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-user mr-2 text-primary-400"></i>Full Name
                            </label>
                            <input id="username" name="username" type="text" required value="{{ user.username }}"
                                class="w-full px-4 py-3 bg-slate-900/50 border border-primary-500/30 rounded-lg text-white
                                       focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 outline-none transition-all">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-envelope mr-2 text-primary-400"></i>Email Address
                            </label>
                            <input id="email" name="email" type="email" required value="{{ user.email }}"
                                class="w-full px-4 py-3 bg-slate-900/50 border border-primary-500/30 rounded-lg text-white
                                       focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 outline-none transition-all">
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-phone mr-2 text-primary-400"></i>Phone Number
                            </label>
                            <input id="phone" name="phone" type="tel" value="{{ user.phone or '' }}"
                                placeholder="+880 1XXX-XXXXXX"
                                class="w-full px-4 py-3 bg-slate-900/50 border border-primary-500/30 rounded-lg text-white
                                       focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-user-tag mr-2 text-primary-400"></i>Account Type
                            </label>
                            <span
                                class="px-4 py-2 bg-primary-500/20 text-primary-400 rounded-full text-sm font-semibold inline-block">
                                {{ user.usertype }}
                            </span>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-calendar mr-2 text-primary-400"></i>Member Since
                            </label>
                            <p class="text-white text-lg">{{ user.created_at.strftime('%B %d, %Y') }}</p>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="glass-light p-8 rounded-xl border border-success-500/30">
                    <h2 class="text-2xl font-bold text-white mb-6">Additional Information</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="address" class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-map-marker-alt mr-2 text-success-400"></i>Address
                            </label>
                            <input id="address" name="address" type="text" value="{{ user.address or '' }}"
                                placeholder="Enter your address"
                                class="w-full px-4 py-3 bg-slate-900/50 border border-success-500/30 rounded-lg text-white
                                       focus:border-success-500 focus:ring-2 focus:ring-success-500/50 outline-none transition-all">
                        </div>

                        <div>
                            <label for="gender" class="block text-sm font-medium text-gray-300 mb-2">
                                {% if user.gender == 'Male' %}
                                <i class="fas fa-mars mr-2 text-blue-400"></i>Gender
                                {% elif user.gender == 'Female' %}
                                <i class="fas fa-venus mr-2 text-pink-400"></i>Gender
                                {% else %}
                                <i class="fas fa-venus-mars mr-2 text-purple-400"></i>Gender
                                {% endif %}
                            </label>
                            <select id="gender" name="gender"
                                class="w-full px-4 py-3 bg-slate-900/50 border border-success-500/30 rounded-lg text-white
                                       focus:border-success-500 focus:ring-2 focus:ring-success-500/50 outline-none transition-all">
                                <option value="" {% if not user.gender %}selected{% endif %}>Prefer not to say</option>
                                <option value="Male" {% if user.gender=='Male' %}selected{% endif %}>
                                    ♂ Male
                                </option>
                                <option value="Female" {% if user.gender=='Female' %}selected{% endif %}>
                                    ♀ Female
                                </option>
                                <option value="Other" {% if user.gender=='Other' %}selected{% endif %}>
                                    ⚧ Other
                                </option>
                            </select>
                        </div>

                        <div>
                            <label for="bio" class="block text-sm font-medium text-gray-300 mb-2">
                                <i class="fas fa-pen mr-2 text-success-400"></i>Bio
                            </label>
                            <textarea id="bio" name="bio" rows="4" placeholder="Tell us about yourself..."
                                class="w-full px-4 py-3 bg-slate-900/50 border border-success-500/30 rounded-lg text-white
                                       focus:border-success-500 focus:ring-2 focus:ring-success-500/50 outline-none transition-all resize-none">{{ user.bio or '' }}</textarea>
                            <p class="mt-1 text-xs text-gray-400">Optional short description</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Information (for customers) -->
            {% if account %}
            <div class="glass-light p-8 rounded-xl border border-gold-500/30">
                <h2 class="text-2xl font-bold text-white mb-6">Account Details</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Account Number</p>
                        <p class="text-white text-lg font-mono font-bold">{{ account.account_number }}</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Account Type</p>
                        <p class="text-white text-lg font-semibold">{{ account.account_type }}</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Current Balance</p>
                        <p class="text-2xl font-bold gradient-text dynamic-money" data-amount="{{ account.balance }}">
                            ৳{{ "%.2f"|format(account.balance|float) }}</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Account Status</p>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold
                                {% if account.status == 'Active' %}bg-success-500/20 text-success-400
                                {% elif account.status == 'Suspended' %}bg-red-500/20 text-red-400
                                {% else %}bg-gray-500/20 text-gray-400{% endif %}">
                            <i class="fas fa-circle text-xs mr-1"></i>{{ account.status }}
                        </span>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="flex justify-end space-x-4">
                <a href="{% if user.usertype == 'BankOfficial' %}/admin/dashboard{% elif user.usertype == 'Staff' %}/staff/dashboard{% else %}/dashboard{% endif %}"
                    class="px-6 py-3 bg-slate-700 text-white rounded-lg font-semibold hover:bg-slate-600 transition-all">
                    <i class="fas fa-times mr-2"></i>Cancel
                </a>
                <button type="submit"
                    class="px-6 py-3 bg-gradient-to-r from-primary-500 to-success-600 text-white rounded-lg font-semibold
                           hover:shadow-lg hover:shadow-primary-500/50 transform hover:scale-105 transition-all duration-300">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
            </div>
        </form>
    </div>
</section>

<script>
    // Dynamic Gender Icon Change
    document.addEventListener('DOMContentLoaded', function () {
        const genderSelect = document.getElementById('gender');
        const genderLabel = genderSelect.previousElementSibling;

        genderSelect.addEventListener('change', function () {
            const selectedGender = this.value;
            let iconHTML = '';

            switch (selectedGender) {
                case 'Male':
                    iconHTML = '<i class="fas fa-mars mr-2 text-blue-400"></i>Gender';
                    break;
                case 'Female':
                    iconHTML = '<i class="fas fa-venus mr-2 text-pink-400"></i>Gender';
                    break;
                case 'Other':
                    iconHTML = '<i class="fas fa-venus-mars mr-2 text-purple-400"></i>Gender';
                    break;
                default:
                    iconHTML = '<i class="fas fa-venus-mars mr-2 text-gray-400"></i>Gender';
                    break;
            }

            genderLabel.innerHTML = iconHTML;
        });
    });
</script>
{% endblock %}